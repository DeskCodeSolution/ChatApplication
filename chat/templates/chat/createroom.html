<!DOCTYPE html>
<html>
<body>

<h2>create rooms</h2>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const addButton = document.createElement('button');
    addButton.textContent = 'Add Users';
    addButton.id = 'addUsersButton';
    document.body.insertBefore(addButton, document.querySelector('script'));

    const usersContainer = document.createElement('div');
    usersContainer.id = 'usersContainer';
    document.body.insertBefore(usersContainer, document.querySelector('script'));

    const selectedUsersContainer = document.createElement('div');
    selectedUsersContainer.id = 'selectedUsersContainer';
    selectedUsersContainer.innerHTML = '<h3>Selected User</h3><p>No user selected</p>';
    document.body.insertBefore(selectedUsersContainer, document.querySelector('script'));

    // Variable to store selected user
    let selectedUser = null;

    document.getElementById('addUsersButton').addEventListener('click', function() {
        // Create a modal/popup
        const modal = document.createElement('div');
        modal.className = 'modal';
        modal.style.cssText = 'position:fixed; top:0; left:0; width:100%; height:100%; background-color:rgba(0,0,0,0.5); display:flex; justify-content:center; align-items:center;';

        const modalContent = document.createElement('div');
        modalContent.className = 'modal-content';
        modalContent.style.cssText = 'background-color:white; padding:20px; border-radius:5px; max-width:500px; max-height:80%; overflow-y:auto;';

        const closeButton = document.createElement('span');
        closeButton.textContent = 'X';
        closeButton.style.cssText = 'float:right; cursor:pointer; font-weight:bold;';
        closeButton.onclick = function() {
            document.body.removeChild(modal);
        };

        modalContent.appendChild(closeButton);
        modalContent.innerHTML += '<h3>Select User</h3>';

        const userListContainer = document.createElement('div');
        modalContent.appendChild(userListContainer);

        modal.appendChild(modalContent);
        document.body.appendChild(modal);

        fetch('http://127.0.0.1:8000/chat/user_register/')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                console.log("data", data)
                userListContainer.innerHTML = '';
                const userList = document.createElement('ul');
                userList.style.listStyleType = 'none';
                userList.style.padding = '0';

                const list = data.data;

                list.forEach(user => {
                    const listItem = document.createElement('li');
                    listItem.style.padding = '8px';
                    listItem.style.cursor = 'pointer';
                    listItem.style.borderBottom = '1px solid #eee';

                    const radio = document.createElement('input');
                    radio.type = 'radio';
                    radio.name = 'selectedUser'; // Same name ensures only one can be selected
                    radio.value = user.name;
                    radio.dataset.userId = user.id;
                    radio.id = 'user_' + user.id;

                    const label = document.createElement('label');
                    label.htmlFor = 'user_' + user.id;
                    label.textContent = user.name;
                    label.style.marginLeft = '10px';

                    listItem.appendChild(radio);
                    listItem.appendChild(label);
                    userList.appendChild(listItem);
                });

                userListContainer.appendChild(userList);

                const selectButton = document.createElement('button');
                selectButton.textContent = 'Add Selected User';
                selectButton.style.marginTop = '15px';
                selectButton.onclick = function() {
                    const selected = userListContainer.querySelector('input[name=selectedUser]:checked');

                    // Update the selected user variable and display
                    selectedUsersContainer.innerHTML = '<h3>Selected User</h3>';
                    if (selected) {
                        selectedUser = {
                            name: selected.value,
                            id: selected.dataset.userId
                        };

                        const userInfo = document.createElement('p');
                        userInfo.textContent = `Name: ${selectedUser.name}, ID: ${selectedUser.id}`;
                        selectedUsersContainer.appendChild(userInfo);

            
                        console.log("Selected User:", selectedUser);
                    } else {
                        selectedUser = null;
                        selectedUsersContainer.innerHTML += '<p>No user selected</p>';
                    }

                    document.body.removeChild(modal);
                };

                modalContent.appendChild(selectButton);
            })
            .catch(error => {
                console.error('Error fetching users:', error);
                userListContainer.innerHTML = '<p>Error loading users. Please try again.</p>';
            });
    });
});
</script>

</body>
</html>
